{% extends "base.html" %}

{% block content %}
<h2>Назначить место</h2>
<form id="assign-form" method="POST" action="{{ url_for('assign') }}">
    <label for="category">Категория:</label>
    <select id="category" name="category_id" required>
        <option value="">Выбрать категорию</option>
        {% for category in categories %}
        <option value="{{ category.id }}">{{ category.name }}</option>
        {% endfor %}
    </select>
    <br>
    <label for="stall">Стенд:</label>
    <select id="stall" name="stall_id" required>
        <option value="">Выбрать стенд</option>
    </select>
    <br>
    <label for="name">Имя:</label>
    <input type="text" id="name" name="assignee_name" required>
    <br>
    <label for="surname">Фамилия:</label>
    <input type="text" id="surname" name="assignee_surname" required>
    <br>
    <label for="amount">Сумма:</label>
    <input type="number" id="amount" name="amount" step="0.01" required>
    <br>
    <button type="submit">Назначить</button>
</form>

<script>
document.getElementById('category').addEventListener('change', function() {
    var categoryId = this.value;
    if (categoryId) {
        fetch('/get_available_stalls/' + categoryId)
            .then(response => response.json())
            .then(data => {
                var stallSelect = document.getElementById('stall');
                stallSelect.innerHTML = '<option value="">Выбрать стенд</option>';
                data.forEach(stall => {
                    var option = document.createElement('option');
                    option.value = stall.id;
                    option.text = stall.number;
                    stallSelect.appendChild(option);
                });
            });
    } else {
        document.getElementById('stall').innerHTML = '<option value="">Выбрать стенд</option>';
    }
});
</script>
{% endblock %}